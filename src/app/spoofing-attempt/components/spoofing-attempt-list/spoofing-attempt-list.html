<div class="dark-container">

  <!-- Card de Filtros -->
  <mat-card class="filter-card mb-4">
    <mat-card-content>
      <form [formGroup]="dateRange" class="filter-toolbar">

        <!-- Filtro de Período -->
        <mat-form-field appearance="outline" class="filter-item period-item">
          <mat-label>Período</mat-label>
          <mat-date-range-input [rangePicker]="picker">
            <input matStartDate formControlName="start" placeholder="Data Inicial"/>
            <input matEndDate formControlName="end" placeholder="Data Final"/>
          </mat-date-range-input>
          <mat-datepicker-toggle matSuffix [for]="picker">
            <mat-icon>calendar_today</mat-icon>
          </mat-datepicker-toggle>
          <mat-date-range-picker
            #picker
            panelClass="custom-datepicker-panel">
          </mat-date-range-picker>
        </mat-form-field>

        <div class="filter-actions">
          <button mat-flat-button color="primary" (click)="exportExcel()">
            <mat-icon>file_download</mat-icon>
            Exportar Excel
          </button>
        </div>

      </form>
    </mat-card-content>
  </mat-card>

  <!-- Card da Tabela -->
  <div class="table-wrapper">
    <table mat-table [dataSource]="dataSource" matSort class="data-table mat-elevation-z8">

      <!-- Coluna ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell class="text-left" *matHeaderCellDef mat-sort-header>ID</th>
        <td mat-cell class="text-left" *matCellDef="let e">{{ e.id }}</td>
      </ng-container>

      <!-- Coluna Data/Hora -->
      <ng-container matColumnDef="attemptDateHour">
        <th mat-header-cell class="text-left" *matHeaderCellDef mat-sort-header>Data/Hora</th>
        <td mat-cell class="text-left" *matCellDef="let e">
          {{ e.attemptDateHour | date:'dd/MM/yyyy HH:mm' }}
        </td>
      </ng-container>

      <!-- Coluna Mapa -->
      <ng-container matColumnDef="map">
        <th mat-header-cell class="text-center" *matHeaderCellDef>Mapa</th>
        <td mat-cell class="text-center" *matCellDef="let e">
          <button mat-icon-button color="primary" (click)="openMap(e.latitude, e.longitude)">
            <mat-icon class="map-icon">map</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Coluna Imagem Spoofing -->
      <ng-container matColumnDef="imageSpoofing">
        <th mat-header-cell class="text-center" *matHeaderCellDef>Foto</th>
        <td mat-cell class="text-center" *matCellDef="let e">
          <img
            class="spoofing-img"
            [src]="'data:image/png;base64,' + e.imageSpoofing"
            alt="Spoofing attempt"
            (click)="openImage(e.imageSpoofing)"
          />
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>

    <mat-paginator
      class="dark-paginator"
      [length]="dataSource.data.length"
      [pageSize]="10"
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons>
    </mat-paginator>
  </div>

</div>
